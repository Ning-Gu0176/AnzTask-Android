

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Code Explain &mdash; ANZ Task Android 1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="ANZ Task Android 1.0 documentation" href="../index.html"/>
        <link rel="up" title="Coding" href="index.html"/>
        <link rel="next" title="Third Party Libraries" href="third_party_libs.html"/>
        <link rel="prev" title="Coding Conventions" href="coding_conventions.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> ANZ Task Android</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/package_content.html">What’s in package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/task_requirement.html">Task Requirement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/problem_analize.html">Problem Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/project_feature.html">App Features</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Coding</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="coding_conventions.html">Coding Conventions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Code Explain</a></li>
<li class="toctree-l2"><a class="reference internal" href="third_party_libs.html">Third Party Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html">Build and Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_docs.html">API docs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing/unit_testing.html">Unit Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/functional_testing.html">Functional Test</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/index.html#how-do-i-add-new-api-support-into-anzvolley-module">How do I add new API support into AnzVolley module?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">How-to guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../howto/create_anzvolley_jar.html">How to build AnzVolley Jar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/unit_test_set_up.html">How to Set Up Unit Test in Android Studio</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ANZ Task Android</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Coding</a> &raquo;</li>
      
    <li>Code Explain</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/coding/code_explain.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="code-explain">
<h1>Code Explain<a class="headerlink" href="#code-explain" title="Permalink to this headline">¶</a></h1>
<div class="section" id="anzvolley-module">
<h2>AnzVolley Module<a class="headerlink" href="#anzvolley-module" title="Permalink to this headline">¶</a></h2>
<p>A good networking library should have following features:</p>
<blockquote>
<div><ul class="simple">
<li>Network requests must be asynchronous and happen outside UI thread.</li>
<li>Network response is always brought back in main thread.</li>
<li>Network cache in local storage.</li>
<li>Simple response method: onSuccess, onError. onSuccess comes with generic arguments for different API request.</li>
<li>Support response of JSON and binary file.</li>
<li>Support multiple threading, customizable thread pool. FIFO queue or based on request priority.</li>
<li>Support cancelling of current running or pending network request.</li>
<li>Network request is able to keep running when app exits if necessary.</li>
<li>Support OAuth2.0, manages(exchange, request and refresh) token internally.</li>
</ul>
</div></blockquote>
<p>There is also another concern about image downloading, even thought it’s not required by ANZ task, but still worth of discussing.</p>
<blockquote>
<div><ul class="simple">
<li>Cache images in memory.</li>
<li>Save thumbnails in storage.</li>
<li>Only load images for items shown on screen.</li>
</ul>
</div></blockquote>
<p>Google Volley almost comes with all above features. However, to make full use of its JSON capability and add good scalability for our earthquake occurrence RESTful API, we need AnzVolley module.</p>
<p>AnzVolley is a wrapper class on top of Google Volley and uses GSON to enhance the capability of RESTful web service.</p>
<p>Use AnzVolley is quite simple, just create a predesign request and add it to request queue. So there are two players here to do the job: Request and AnzVolley.</p>
<p>AnzVolley itself is a singleton class because we want to access this resource from anywhere in the project and all request share the same request queue, there is no need to have multiple instance of AnzVolley class.</p>
<p>Request is generated through <cite>AnzVolleyRestfulRequestFactory</cite> class’s factory method. Because every RESTful API request (RequestEarthquake, RequestWeather, etc.) inherits from the same <cite>RequestObject</cite> class, it’s just so easy to use one single factory method to generate all different kinds of products (requests).</p>
<p>After request instance is produced, adding it to request queue would start http request right away. However, we still have a problem: how to mapping the response to the right request? The answer is generic class.</p>
<p>Without generic class, we have to define new factory method for new RESTful API request because the response class is different. With generic class, we can specify the type of response as <cite>T</cite> and cast the response JSON string like this:
T parsedGSON = mGson.fromJson(jsonString, mType);
and then return the parsedGSON through interface call back which accept T type as argument as well.</p>
<p>With generic class and factory design pattern, scalability couldn’t be much better. If we need to add another RESTful API to current AnzVolley module, just do following steps:</p>
<blockquote>
<div><ul class="simple">
<li>Create the new request class which conforms to request parameter.</li>
<li>Create the new corresponding response class which conforms to the JSON response format.</li>
<li>Go to AnzVolleyRestfulRequestFactory class and give the new API an ID and define it’s URL.</li>
<li>Still in AnzVolleyRestfulRequestFactory class, add another <cite>switch case</cite> code block for new API and that’s it.</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">New API request and response’s member variables should have exact the same name as in JSON’s key name. Although this is not mandatory but good practice. Please refer GSON’s website for more information.</p>
</div>
</div>
<div class="section" id="circle-flip-button">
<h2>Circle Flip Button<a class="headerlink" href="#circle-flip-button" title="Permalink to this headline">¶</a></h2>
<p>Circle Flip Button is a mimic of Android Gmail’s mail delete button. The principle behind it is using ObjectAnimator to do a <cite>flipY</cite> animation. However, flip the view 180 degrees would also cause the text to be flipped. The best solution is splitting the 180 degrees flip animation into two parts: from 0 degree to 90 degrees animation and then from -90 degrees to 0 degree animation. This trick gives a fake impression that the view flips 180 degrees in one direction but actually it flip 90 degrees in one direction and then 90 degrees in another direction, but still keeps the text in correct orientation.</p>
</div>
<div class="section" id="log">
<h2>Log<a class="headerlink" href="#log" title="Permalink to this headline">¶</a></h2>
<p>There are two custom log class (AnzLog and AnzVolleyLog) in this project, both of which are just simple and thin wrapper on top of JAVA Log class. The extra capability these custom log class is a boolean flag to turn on or turn off logs for different builds. Normally we use logs in debug stage and disable logs when release. But this is relatively tedious to do in Eclipse because flag needs to be manually cleared for release. Now, Thanks to Android Studio’s build mechanism, this can be easily achieved by checking <cite>BuildConfig.DEBUG</cite> to turn on or off logs output.</p>
</div>
<div class="section" id="design-pattern">
<h2>Design Pattern<a class="headerlink" href="#design-pattern" title="Permalink to this headline">¶</a></h2>
<p>In this ANZ task project, three design pattern is used:</p>
<blockquote>
<div><ul class="simple">
<li>Simple factory design pattern.</li>
<li>Singleton design pattern.</li>
<li>Composition design pattern.</li>
</ul>
</div></blockquote>
<p>All of them are implemented in AnzVolley module.</p>
</div>
<div class="section" id="build-script">
<h2>Build Script<a class="headerlink" href="#build-script" title="Permalink to this headline">¶</a></h2>
<p>Android Studio’s build script file is <cite>build.gradle</cite>. Each module comes with one such file and there a <cite>build.gradle</cite> file in project root folder, too. The build process is similar to ADT but Gradle can also package module into AAR (Android Archive) file and upload to local Maven repository or remote Maven repository. Since AnzVolley module has no resources, it’s better to distribute it in JAR format so Android project in Eclipse can still use it.</p>
<p>Please navigate to project source folder for more information.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="third_party_libs.html" class="btn btn-neutral float-right" title="Third Party Libraries"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="coding_conventions.html" class="btn btn-neutral" title="Coding Conventions"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Australia and New Zealand Banking Group Limited .
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>